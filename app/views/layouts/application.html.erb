<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Coffee Recorder</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
	  <%= stylesheet_link_tag "application" %>
		<%= javascript_include_tag "application" %>
	  <%= csrf_meta_tags %>
		<script src="http://cdn-static.viddler.com/js/viddler.js" type="text/javascript"></script>
		<%= javascript_tag do %>
			<% flash.each do |key, msg| %>
				$.alert('<%= msg %>', '<%= key %>');
			<% end %>
		<% end %>
		
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
  </head>

  <body>
    <div class="topbar">
			<div class="alert-message block-message error fade in hide">
			  <a class="close" href="#">×</a>
			  <p><strong>Holy guacamole!</strong> Best check yo self, you’re not looking too good.</p>
				<ul>
					<li>Duis mollis est non commodo luctus</li>
					<li>Nisi erat porttitor ligula</li>
					<li>Eget lacinia odio sem nec elit</li>
				</ul>
			</div>
      <div class="fill">
        <div class="container">
          <a class="brand" href="/">Coffee <span class="label important">Recorder</span></a>
          <ul class="nav">
            <li>
							<a href="#about" data-controls-modal="modal-about" data-backdrop="static">About</a>
							<div id="modal-about" class="modal hide fade in">
								<div class="modal-header">
									<a href="#" class="close">×</a>
									<h3>About Coffee Recorder</h3>
								</div>
								<div class="modal-body">
									<p>This is a prototype of a video recording and uploading app.</p>
									<p>The recorder as well as the video player can be customized as <a href="http://www.viddler.com/" target="_blank">white-label solution</a>. Videos can be set as completely private, public, or configured according to a custom workflow.</p>
								</div>
							</div>
						</li>
            <li>
							<%= mail_to "rubylabs@bvision.com", "Contact", :encode => "javascript" %>
						</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <h1>Broadcast Coffee</h1>
        <p>Tell us what's your favorite coffee flavor and you will be featured in the video gallery.</p>
        <p>
					<a id="upload-button" class="btn primary large" data-controls-modal="modal-uploader" data-backdrop="static">Upload your own Video</a>
					&nbsp;or&nbsp;
					<a id="record-button" class="btn secondary large" data-controls-modal="modal-recorder" data-backdrop="static">Use Webcam</a>
				</p>

				<!-- upload modal -->
				<div id="modal-uploader" class="modal hide fade in">
					<div class="modal-header">
						<a href="#" class="close">×</a>
						<h3>Video Upload</h3>
					</div>
					<%= form_tag video_upload_url, :id => "upload-form", :multipart => true do |f| %> 
						<%= hidden_field_tag :uploadtoken, video_upload_token %>
						<%= hidden_field_tag :callback, uploaded_videos_url %>
						<div class="modal-body">
							<p>
								<fieldset>
									<div class="clearfix file required">
										<label for="file"><abbr title="required">*</abbr> Video file</label>
										<div class="input">
											<%= file_field_tag :file, "data-validate" => "true" %>
											<span class="help-block">Video footage no more than 1 minute in length.</span>
										</div>
									</div>
								</fieldset>	
							</p>
						</div>
						<div class="modal-footer">
							<input type="submit" class="btn primary" value="Upload">&nbsp;
							<button type="reset" class="btn cancel">Cancel</button>
						</div>
					<% end %>
				</div>

				<!-- record modal -->
				<div id="modal-recorder" class="modal hide fade in">
					<div class="modal-header">
						<a href="#" class="close">×</a>
						<h3>Live Recorder</h3>
					</div>
					<div class="modal-body">
						<p>
							<%
								width = 525
								height = 436
								flashvars = "recQuality=M&maxlength=20&fake=1&recordToken=#{@record_token}"
							%>
							<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="<%= width %>" height="<%= height %>" id="viddler_recorder" align="middle"> 
								<param name="allowScriptAccess" value="always" /> 
								<param name="allowNetworking" value="all" /> 
								<param name="movie" value="http://cdn-static.viddler.com/flash/recorder.swf" /> 
								<param name="quality" value="high" /> 
								<param name="scale" value="noScale"> 
								<param name="bgcolor" value="#000000" /> 
								<param name="flashvars" value="<%= flashvars %>" /> 
								<embed src="http://cdn-static.viddler.com/flash/recorder.swf" quality="high" scale="noScale" bgcolor="#000000" allowScriptAccess="always" allowNetworking="all" width="<%= width %>" height="<%= height %>" name="viddler_recorder" flashvars="<%= flashvars %>" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />
							</object>
							<script>
								function recordDone(username, user_video_number, video_id) {
									var json = {video:{video_id: video_id, source: "webcam"}}
									$.post('<%= videos_path %>', json);
									// $('#videos').load('<%= list_videos_path %>');
									// $(document).trigger("hide-popovers");
								}

								function recordStopped() {
									$(document).trigger("hide-popovers");
								}
							</script>
						</p>
					</div>
				</div>
      </div>
      <h2>Latest Videos</h2>
			<ul id="videos" class="media-grid">
				<li><p>Loading...<p></li>
			</ul>
			<%= yield %>
      <footer>
        <p>&copy; Business Vision 2011</p>
      </footer>

    </div> <!-- /container -->

  </body>
</html>