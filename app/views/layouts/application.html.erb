<!DOCTYPE html>
<html lang="en" xmlns:fb="https://www.facebook.com/2008/fbml">
  <head>
    <meta charset="utf-8">
    <title><%= page_title %></title>
    <meta name="description" content="">
    <meta name="author" content="Business Vision">
		<meta property="og:title" content="<%= fb_title %>" />
		<meta property="og:type" content="movie" />
		<meta property="og:url" content="<%= url_for({}) %>" />
		<meta property="og:image" content="<%= fb_thumbnail_url %>" />
		<meta property="og:site_name" content="<%= t "site.name" %>" />
		<meta property="fb:admins" content="722924084" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
	  <%= stylesheet_link_tag "application" %>
		<%= javascript_include_tag "application" %>
	  <%= csrf_meta_tags %>
	  <%= javascript_include_tag "//cdn-static.viddler.com/js/viddler.js" %>
	  <%= javascript_include_tag "//platform.twitter.com/widgets.js" %>
		<%= javascript_tag do %>
			<% flash.each do |key, msg| %>
				$.alert('<%= msg %>', '<%= key %>');
			<% end %>
		<% end %>
		
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
  </head>

  <body>
    <div class="topbar">
			<div class="alert-message block-message error fade in hide"></div>
      <div class="fill">
        <div class="container">
          <a class="brand" href="/"><%=raw t "topbar.brand" %></a>
          <ul class="nav">
            <li>
							<a href="#about" data-controls-modal="modal-about" data-backdrop="static"><%=raw t "topbar.about" %></a>
							<div id="modal-about" class="modal hide fade in">
								<div class="modal-header">
									<a href="#" class="close">×</a>
									<h3><%=raw t "topbar.about" %> <%= t "site.name" %></h3>
								</div>
								<div class="modal-body">
									<p><%=raw t "about.one" %></p>
									<p><%=raw t "about.two" %></p>
									<p><%=raw t "about.three" %></p>
								</div>
							</div>
						</li>
            <li>
							<%= mail_to "rubylabs@bvision.com", t("topbar.contact"), :encode => "javascript" %>
						</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <h1><%= t "home.title" %></h1>
        <p><%= t "home.description" %></p>
        <p>
					<a id="upload-button" class="btn primary large" data-controls-modal="modal-uploader" data-backdrop="static"><%= t "home.upload" %></a>
					&nbsp;<%= t "home.or" %>&nbsp;
					<a id="record-button" class="btn secondary large" data-controls-modal="modal-recorder" data-backdrop="static"><%= t "home.webcam" %></a>
				</p>

				<!-- upload modal -->
				<div id="modal-uploader" class="modal hide fade in">
					<div class="modal-header">
						<a href="#" class="close">×</a>
						<h3><%= t "upload.title" %></h3>
					</div>
					<%= form_tag video_upload_url, :id => "upload-form", :multipart => true do |f| %> 
						<%= hidden_field_tag :uploadtoken, video_upload_token %>
						<%= hidden_field_tag :callback, uploaded_videos_url %>
						<div class="modal-body">
							<p>
								<fieldset>
									<div class="clearfix file required">
										<label for="file"><abbr title="required">*</abbr> <%= t "activerecord.attributes.video.file" %></label>
										<div class="input">
											<%= file_field_tag :file, "data-validate" => "true" %>
											<span class="help-block"><%= t "activerecord.hints.video.file" %></span>
										</div>
									</div>
								</fieldset>	
							</p>
						</div>
						<div class="modal-footer">
							<input type="submit" class="btn primary" value="<%= t "upload.submit" %>">&nbsp;
							<button type="reset" class="btn cancel"><%= t "upload.reset" %></button>
						</div>
					<% end %>
				</div>

				<!-- record modal -->
				<div id="modal-recorder" class="modal hide fade in">
					<div class="modal-header">
						<a href="#" class="close">×</a>
						<h3><%= t "record.title" %></h3>
					</div>
					<div class="modal-body">
						<p>
							<%
								width = 525
								height = 436
								flashvars = "recQuality=M&maxlength=20&fake=1&recordToken=#{@record_token}"
							%>
							<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"  codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="<%= width %>" height="<%= height %>" id="viddler_recorder" align="middle"> 
								<param name="allowScriptAccess" value="always" /> 
								<param name="allowNetworking" value="all" /> 
								<param name="movie" value="http://cdn-static.viddler.com/flash/recorder.swf" /> 
								<param name="quality" value="high" /> 
								<param name="scale" value="noScale"> 
								<param name="bgcolor" value="#000000" /> 
								<param name="flashvars" value="<%= flashvars %>" /> 
								<embed src="http://cdn-static.viddler.com/flash/recorder.swf" quality="high" scale="noScale" bgcolor="#000000" allowScriptAccess="always" allowNetworking="all" width="<%= width %>" height="<%= height %>" name="viddler_recorder" flashvars="<%= flashvars %>" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />
							</object>
						</p>
					</div>
				</div>
      </div>
      <h2><%= t "home.list_header" %></h2>
			<ul id="videos" class="media-grid">
				<li><p><%= t "home.list_loading" %><p></li>
			</ul>
			
			<%= yield %>
			
      <footer>
        <p>
					&copy; <%= t("site.company") %> <%= Time.now.year %>
				</p>
				<div class="share">
					<div class="twitter-button">
					  <a href="https://twitter.com/share?url=<%= root_url %>&amp;via=business_vision&amp;text=<%=u t("twitter", :title => "").strip %>" class="twitter-share-button">Tweet</a>
					</div>
					<div class="facebook-button">
						<fb:like send="false" layout="button_count" width="250" show_faces="false" href="<%= root_url %>"></fb:like>
					</div>
				</div>
      </footer>

    </div> <!-- /container -->
		<!-- facebook -->
		<div id="fb-root"></div>
		<%= javascript_tag do %>
			window.fbAsyncInit = function() {
				FB.init({
					appId  : '145968922165089',
					status : true,
					cookie : true,
					xfbml  : true
				});
			};

			(function() {
				var e = document.createElement('script');
				e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
				e.async = true;
				document.getElementById('fb-root').appendChild(e);
			}());
		<% end %>
  </body>
</html>